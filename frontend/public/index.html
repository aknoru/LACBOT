<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#3b82f6" />
    <meta
      name="description"
      content="LACBOT - Campus Multilingual Chatbot for Student Support"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom CSS for widget styling -->
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      code {
        font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
          monospace;
      }
      
      /* Widget specific styles */
      .lacbot-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
      
      .lacbot-chat-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        border: 1px solid #e5e7eb;
        overflow: hidden;
        transition: all 0.3s ease;
      }
      
      .lacbot-chat-header {
        background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
        color: white;
        padding: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      
      .lacbot-chat-button {
        background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
        color: white;
        border: none;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }
      
      .lacbot-chat-button:hover {
        transform: scale(1.05);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      
      .lacbot-message {
        margin-bottom: 12px;
        display: flex;
        align-items: flex-start;
      }
      
      .lacbot-message.user {
        justify-content: flex-end;
      }
      
      .lacbot-message.bot {
        justify-content: flex-start;
      }
      
      .lacbot-message-content {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 18px;
        word-wrap: break-word;
      }
      
      .lacbot-message.user .lacbot-message-content {
        background: #3b82f6;
        color: white;
        border-bottom-right-radius: 6px;
      }
      
      .lacbot-message.bot .lacbot-message-content {
        background: #f3f4f6;
        color: #374151;
        border-bottom-left-radius: 6px;
      }
      
      .lacbot-input-area {
        padding: 16px;
        border-top: 1px solid #e5e7eb;
        background: white;
      }
      
      .lacbot-input-container {
        display: flex;
        gap: 8px;
        align-items: flex-end;
      }
      
      .lacbot-textarea {
        flex: 1;
        border: 1px solid #d1d5db;
        border-radius: 12px;
        padding: 12px;
        resize: none;
        font-family: inherit;
        font-size: 14px;
        line-height: 1.5;
        outline: none;
        transition: border-color 0.2s;
      }
      
      .lacbot-textarea:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .lacbot-send-button {
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 12px;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      
      .lacbot-send-button:hover:not(:disabled) {
        background: #2563eb;
      }
      
      .lacbot-send-button:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }
      
      .lacbot-loading {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: #f3f4f6;
        border-radius: 18px;
        border-bottom-left-radius: 6px;
        max-width: 80%;
      }
      
      .lacbot-spinner {
        width: 16px;
        height: 16px;
        border: 2px solid #e5e7eb;
        border-top: 2px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Responsive design */
      @media (max-width: 768px) {
        .lacbot-widget {
          bottom: 10px;
          right: 10px;
        }
        
        .lacbot-chat-container {
          width: calc(100vw - 20px);
          height: calc(100vh - 20px);
          border-radius: 0;
        }
      }
    </style>
    
    <title>LACBOT - Campus Chatbot</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    
    <!-- Widget Embed Script -->
    <script>
      // LACBOT Widget Embed Script
      (function() {
        // Configuration
        const CONFIG = {
          apiUrl: 'http://localhost:8000/api',
          widgetId: 'lacbot-widget',
          theme: 'default',
          position: 'bottom-right'
        };
        
        // Create widget container
        function createWidget() {
          const container = document.createElement('div');
          container.id = CONFIG.widgetId;
          container.className = 'lacbot-widget';
          container.innerHTML = `
            <div id="lacbot-chat-container" class="lacbot-chat-container" style="display: none; width: 350px; height: 500px;">
              <div class="lacbot-chat-header">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                  <span style="font-weight: 600;">LACBOT Assistant</span>
                </div>
                <button id="lacbot-close" style="background: none; border: none; color: white; cursor: pointer;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                  </svg>
                </button>
              </div>
              <div id="lacbot-messages" style="flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px;">
                <div class="lacbot-message bot">
                  <div class="lacbot-message-content">
                    Hello! I'm LACBOT, your campus assistant. How can I help you today?
                  </div>
                </div>
              </div>
              <div class="lacbot-input-area">
                <div class="lacbot-input-container">
                  <textarea id="lacbot-input" class="lacbot-textarea" placeholder="Type your message..." rows="2"></textarea>
                  <button id="lacbot-send" class="lacbot-send-button">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            <button id="lacbot-toggle" class="lacbot-chat-button">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
              </svg>
            </button>
          `;
          
          document.body.appendChild(container);
          return container;
        }
        
        // Initialize widget
        function initWidget() {
          const widget = createWidget();
          const container = document.getElementById('lacbot-chat-container');
          const toggle = document.getElementById('lacbot-toggle');
          const close = document.getElementById('lacbot-close');
          const messagesContainer = document.getElementById('lacbot-messages');
          const input = document.getElementById('lacbot-input');
          const send = document.getElementById('lacbot-send');
          
          let isOpen = false;
          
          // Toggle chat
          function toggleChat() {
            isOpen = !isOpen;
            container.style.display = isOpen ? 'flex' : 'none';
            if (isOpen) {
              input.focus();
            }
          }
          
          // Send message
          function sendMessage() {
            const message = input.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Show loading
            const loading = document.createElement('div');
            loading.className = 'lacbot-loading';
            loading.innerHTML = `
              <div class="lacbot-spinner"></div>
              <span>Thinking...</span>
            `;
            messagesContainer.appendChild(loading);
            
            // Send to API
            fetch(CONFIG.apiUrl + '/chat/message', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                message: message,
                language: 'auto'
              })
            })
            .then(response => response.json())
            .then(data => {
              // Remove loading
              loading.remove();
              
              // Add bot response
              addMessage(data.response || 'Sorry, I encountered an error.', 'bot');
            })
            .catch(error => {
              // Remove loading
              loading.remove();
              
              // Add error message
              addMessage('Sorry, I\'m experiencing technical difficulties. Please try again later.', 'bot');
              console.error('Chatbot error:', error);
            });
          }
          
          // Add message to chat
          function addMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `lacbot-message ${type}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'lacbot-message-content';
            contentDiv.textContent = text;
            
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }
          
          // Event listeners
          toggle.addEventListener('click', toggleChat);
          close.addEventListener('click', toggleChat);
          send.addEventListener('click', sendMessage);
          
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              sendMessage();
            }
          });
          
          // Auto-resize textarea
          input.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
          });
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initWidget);
        } else {
          initWidget();
        }
      })();
    </script>
  </body>
</html>
